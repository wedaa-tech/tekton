apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerBinding
metadata:
  name: <%= ComponentName %>-push-trigger-binding
  namespace: <%= namespaceName %>
spec:
  params:
    - name: repo-url
      value: github.com/$(body.repository.full_name).git
    - name: revision
      value: $(body.head_commit.id)
    - name: auther
      value: $(body.head_commit.author.name)
    - name: submodules
      value: "false"
    - name: git-branch
      value: $(body.ref)    
    - name: image-reference
      value: <%= imageUri %>      

---
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerTemplate
metadata:
  name: <%= ComponentName %>-push-trigger-template
  namespace: <%= namespaceName %>
spec:
  params:
    - name: repo-url
    - name: revision
      default: main
    - name: submodules
    - name: git-branch
    - name: auther
    - name: image-reference
    

  resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
      kind: PipelineRun
      metadata:
        generateName: <%= ComponentName %>-push-trigger-run-
      spec:
        serviceAccountName: tekton-service-account
        pipelineRef:
          name: <%= ComponentName %>-pipeline
        podTemplate:
          securityContext:
            fsGroup: 65532
        workspaces:
          - name: shared-data
            persistentVolumeClaim:
              claimName: tekton-pvc
          - name: docker-config
            emptyDir: {}
          - name: cache-dir
            emptyDir: {}
          - name: github-secret
            secret:
              secretName: github-secret
        params:
          - name: repo-url
            value: $(tt.params.repo-url)
          - name: revision
            value: $(tt.params.revision)
          - name: submodules
            value: $(tt.params.submodules)
          - name: image-reference
            value: $(tt.params.image-reference)
          - name: git-branch
            value: $(tt.params.git-branch)
          - name: auther
            value: $(tt.params.auther)
    

---
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerBinding
metadata:
  name: <%= ComponentName %>-pr-trigger-binding
  namespace: <%= namespaceName %>
spec:
  params:
    - name: revision
      value: $(body.pull_request.head.ref)
    - name: repo-url
      value: github.com/$(body.repository.full_name).git
    - name: commit-sha
      value: $(body.pull_request.head.sha)
    - name: git-branch
      value: $(body.pull_request.head.ref)
    - name: submodules
      value: "false"
    - name: image-reference
      value: <%= imageUri %>
 

---
apiVersion: triggers.tekton.dev/v1beta1
kind: TriggerTemplate
metadata:
  name: <%= ComponentName %>-pr-trigger-template
  namespace: <%= namespaceName %>
spec:
  params:
    - name: revision
    - name: commit-sha
    - name: repo-url
    - name: image-reference
    - name: submodules
    - name: git-branch
  

  resourcetemplates:
    - apiVersion: tekton.dev/v1beta1
      kind: PipelineRun
      metadata:
        generateName: <%= ComponentName %>-pr-trigger-run-
      spec:
        serviceAccountName: tekton-service-account
        pipelineRef:
          name: <%= ComponentName %>-pr-test-cases
        podTemplate:
          securityContext:
            fsGroup: 65532
        workspaces:
          - name: shared-data
            persistentVolumeClaim:
              claimName: tekton-pvc
          - name: github-secret
            secret:
              secretName: github-secret

        params:
          - name: repo-url
            value: $(tt.params.repo-url)
          - name: commit-sha
            value: $(tt.params.commit-sha)
          - name: revision
            value: $(tt.params.revision)
          - name: submodules
            value: $(tt.params.submodules)
          - name: git-branch
            value: $(tt.params.git-branch)
       
